syntax="proto3";

import "google/protobuf/timestamp.proto";

package amqp;

option go_package = ".;amqp";

message RabbitMQMessage
{
    Type     type     = 1;
    Language language = 2;
    Status   status   = 3;
    
    NewsTwitterMessage          newsTwitterMessage          = 10;
    NewsRSSMessage              newsRSSMessage              = 11;
    PortalPositionRequest       portalPositionRequest       = 12;
    PortalPositionAnswer        portalPositionAnswer        = 13;
    ConfigurationDisplayRequest configurationDisplayRequest = 14;
    ConfigurationDisplayAnswer  configurationDisplayAnswer  = 15;
    ConfigurationWebhookRequest configurationWebhookRequest = 16;
    ConfigurationWebhookAnswer  configurationWebhookAnswer  = 17;
    ConfigurationServerRequest  configurationServerRequest  = 18;
    ConfigurationServerAnswer   configurationServerAnswer   = 19;

    enum Type
    {
        UNKNOWN                       =  0;
        NEWS_RSS                      =  1;
        NEWS_TWITTER                  =  2;
        PORTAL_POSITION_REQUEST       =  3;
        PORTAL_POSITION_ANSWER        =  4;
        CONFIGURATION_DISPLAY_REQUEST =  5;
        CONFIGURATION_DISPLAY_ANSWER  =  6;
        CONFIGURATION_WEBHOOK_REQUEST =  7;
        CONFIGURATION_WEBHOOK_ANSWER  =  8;
        CONFIGURATION_SERVER_REQUEST  =  9;
        CONFIGURATION_SERVER_ANSWER   = 10;
    }

    enum Language 
    {
        ANY = 0;
        FR  = 1;
        EN  = 2;
        ES  = 3;
    }

    enum Status 
    {
        SUCCESS = 0;
        FAILED  = 1;
    }
}

message NewsTwitterMessage
{
    string title         = 1;
    string authorName    = 2;
    string authorUrl     = 3;
    string authorIconUrl = 4;
    string url           = 5;
    string iconUrl       = 6;
    string content       = 7;
}

message NewsRSSMessage
{
	string                    title      = 1;
    string                    authorName = 2;
    string                    url        = 3;
    string                    iconUrl    = 4;
    google.protobuf.Timestamp date       = 5;
}

message PortalPositionRequest
{
    string serverId    = 1;
    string dimensionId = 2;
}

message PortalPositionAnswer
{
    repeated PortalPosition positions = 1;

    message PortalPosition {
        string                    serverId      = 1;
        string                    dimensionId   = 2;
        int32                     remainingUses = 3;
        Position                  position      = 4;
        string                    createdBy     = 5;
        string                    updatedBy     = 6;
        google.protobuf.Timestamp createdAt     = 7;
        google.protobuf.Timestamp updatedAt     = 8;
        Source                    source        = 9;

        message Position {
            int32 x                        = 1;
            int32 y                        = 2;
            bool isInCanopy                = 3;
            Transport transport            = 4;
            Transport conditionalTransport = 5;

            message Transport {
                string areaId    = 1;
                string subAreaId = 2;
                string typeId    = 3;
                int32 x          = 4;
                int32 y          = 5;
            }
        }

        message Source {
            string name = 1;
            string icon = 2;
            string url  = 3;
        }
    }
}

message ConfigurationDisplayRequest
{
    string guildId = 1;
}

message ConfigurationDisplayAnswer
{
    // TODO
    string guildId = 1;
}

message ConfigurationWebhookRequest
{
    string   guildId   = 1;
    string   channelId = 2;
    bool     enabled   = 3;
    Provider provider  = 4;

    enum Provider {
        ALMANAX = 0;
        RSS     = 1;
        TWITTER = 2;
    }
}

message ConfigurationWebhookAnswer
{
}

message ConfigurationServerRequest
{
    string guildId   = 1;
    string channelId = 2;
    string serverId  = 3;
}

message ConfigurationServerAnswer
{
}